{% extends "user/user_base.html" %}
{% block content %}
<style>
    .dashboard-container {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .section {
        margin-bottom: 40px;
    }

    .section h3 {
        margin-bottom: 20px;
        font-size: 1.5rem;
        color: #333;
    }

    /* Full-width bar chart styling with fixed height */
    .full-width-chart {
        width: 80%;
        height: 400px; 
        display: block;
        margin: 0 10%;
    }

    /* Charts row for side-by-side comparisons */
    .charts-row {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }

    .chart {
        flex: 1;
        min-width: 200px;
        max-width: 60%;
        margin-left: 20px;
    }

    /* Table styling with improved colors */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        color: #333;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-left: 20px;
    }

    th, td {
        padding: 12px 15px;
        text-align: center;
        border: 1px solid #ddd;
    }

    th {
        background-color: #4CAF50; /* Header background color */
        color: white;
    }

    tr:nth-child(even) {
        background-color: #f9f9f9; /* Alternating row color */
    }

    tr:nth-child(odd) {
        background-color: #ffffff;
    }

    td {
        background-color: #fafafa;
    }

    tr:hover {
        background-color: #f1f1f1; /* Row hover effect */
    }
    p
    {
        text-align: center;
        color: rgb(255, 187, 0);
        font-weight: bolder;
        font-style: oblique;
        font-size: larger;
    }
    h3
    {
        margin-left: 20px;
    }
</style>

<div class="dashboard-container">
    <p>Welcome, {{ user.first_name }} {{ user.last_name }}!</p>
    <div class="section">
        <h3>Tax Details</h3>
        {% if tax_details %}
            <table>
                <thead>
                    <tr>
                        <th>Financial Year</th>
                        <th>Gross Income</th>
                        <th>Total Deductions</th>
                        <th>Taxable Income_old</th>
                        <th>Taxable Income_new</th>
                        <th>Old Regime Tax</th>
                        <th>New Regime Tax</th>
                        <th>Eff.old_taxRate</th>
                        <th>Eff.new_taxRate</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{{ financial_year }}</td>
                        <td>{{ tax_details.gross_income }}</td>
                        <td>{{ tax_details.total_deductions }}</td>
                        <td>{{ tax_details.taxable_income_old_regime }}</td>
                        <td>{{ tax_details.taxable_income_new_regime }}</td>
                        <td>{{ tax_details.tax_old_regime }}</td>
                        <td>{{ tax_details.tax_new_regime }}</td>
                        <td id="effectiveTaxOldRegime">0%</td>
                        <td id="effectiveTaxNewRegime">0%</td>
                    </tr>
                </tbody>
            </table>
        {% else %}
            <p>No tax details available.</p>
        {% endif %}
    </div>
       <!-- 4. Document Verification Status -->
       <div class="section">
        <h3>Document Verification Status</h3>
        {% if document_status %}
            <table>
                <thead>
                    <tr>
                        <th>Document Type</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for doc_type, status in document_status.items %}
                        <tr>
                            <td>{{ doc_type }}</td>
                            <td>{{ status }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No documents found.</p>
        {% endif %}
    </div>
</div>
    <!-- 1. Income Breakdown (Full-Width Bar Chart) -->
    <div class="section">

        <h3>Income Breakdown</h3>
        {% if income_breakdown %}
            <img src="data:image/png;base64,{{ income_breakdown }}" alt="Income Breakdown" class="full-width-chart">
        {% else %}
            <p>No income details available.</p>
        {% endif %}
    </div>
    
    <!-- 2. Deductions and Tax Comparison Charts (Side-by-Side) -->
    <div class="section charts-row">
        {% if deductions_breakdown %}
            <div class="chart">
                <h3>Deductions Breakdown</h3>
                <img src="data:image/png;base64,{{ deductions_breakdown }}" alt="Deductions Breakdown">
            </div>
        {% endif %}
        {% if tax_comparison %}
            <div class="chart">
                <h3>Old vs New Regime Tax Comparison</h3>
                <img src="data:image/png;base64,{{ tax_comparison }}" alt="Tax Comparison">
            </div>
        {% endif %}
    </div>
    <script>
        // Function to calculate effective tax rate
        function calculateEffectiveTaxRate(tax, income) {
            if (income > 0) {
                return ((tax / income) * 100).toFixed(2) + "%";
            }
            return "0%";
        }
    
        // Function to display the effective tax rates
        function displayEffectiveTaxRates() {
            // Parse values from Django template variables
            const taxOldRegime = parseFloat("{{ tax_details.tax_old_regime|default:0 }}");
            const taxableIncomeOldRegime = parseFloat("{{ tax_details.taxable_income_old_regime|default:0 }}");
            
            const taxNewRegime = parseFloat("{{ tax_details.tax_new_regime|default:0 }}");
            const taxableIncomeNewRegime = parseFloat("{{ tax_details.taxable_income_new_regime|default:0 }}");
    
            console.log("Tax Old Regime:", taxOldRegime);           // Check if values are correctly passed
            console.log("Taxable Income Old Regime:", taxableIncomeOldRegime);
            console.log("Tax New Regime:", taxNewRegime);
            console.log("Taxable Income New Regime:", taxableIncomeNewRegime);
    
            // Calculate and display for old regime
            document.getElementById("effectiveTaxOldRegime").innerText = calculateEffectiveTaxRate(taxOldRegime, taxableIncomeOldRegime);
            
            // Calculate and display for new regime
            document.getElementById("effectiveTaxNewRegime").innerText = calculateEffectiveTaxRate(taxNewRegime, taxableIncomeNewRegime);
        }
    
        // Run the function after the page loads
        window.onload = displayEffectiveTaxRates;
    </script>
    

 
{% endblock %}
